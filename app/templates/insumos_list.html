<!-- templates/insumos_list.html -->
{% extends 'base.html' %} {% block title %}Insumos · Patitas QR{% endblock %} {%
block content %}
<section class="list-page">
  <header class="list-header">
    <h2 class="list-title">Insumos</h2>
  </header>

  <h3 class="section-title">Nuevo insumo</h3>
  <div class="card">
    <form
      method="post"
      action="{{ url_for('insumos.crear_insumo') }}"
      class="form-grid form-inline"
    >
      <div class="field" style="min-width: 220px">
        <label for="nombre">Nombre</label>
        <input id="nombre" type="text" name="nombre" required />
      </div>

      <div class="field" style="min-width: 200px">
        <label for="unidad">Unidad</label>
        <input
          id="unidad"
          name="unidad"
          placeholder="ml, mg, dosis, comprimidos, unidades, etc."
          type="text"
          required
        />
      </div>

      <div class="field" style="min-width: 160px">
        <label for="stock">Stock</label>
        <input
          id="stock"
          name="stock"
          type="number"
          step="0.01"
          min="1"
          value="0"
          required
        />
      </div>

      <div class="field" style="min-width: 200px">
        <label for="fecha_vencimiento">Vence</label>
        <input
          id="fecha_vencimiento"
          name="fecha_vencimiento"
          type="date"
          min="{{ today }}"
          required
        />
      </div>

      <button type="submit" class="btn btn-primary btn-eq">Agregar</button>
    </form>
  </div>

  <h3 class="section-title">Insumos disponibles</h3>

  <form
    method="get"
    action="{{ url_for('insumos.lista_insumos') }}"
    class="toolbar"
  >
    <div class="searchbar">
      <label for="q" class="sr-only">Buscar</label>
      <input
        id="q"
        name="q"
        value="{{ q or '' }}"
        placeholder="Buscar por nombre o unidad"
        autocomplete="off"
      />
    </div>
    <div class="toolbar-actions">
      <button
        type="submit"
        class="btn btn-primary btn-eq"
        style="margin-bottom: 10px"
      >
        Buscar
      </button>
      <a
        class="btn btn-outline btn-eq"
        href="{{ url_for('insumos.lista_insumos') }}"
        >Limpiar</a
      >
    </div>
  </form>

  {% if insumos|length == 0 %}
  <div class="empty-state">
    <p>No hay insumos disponibles.</p>
  </div>
  {% else %}
  <div class="table-wrap">
    <table class="table table--list">
      <thead>
        <tr>
          <th class="id-column">ID</th>
          <th>Nombre</th>
          <th style="width: 140px">Unidad</th>
          <th style="width: 100px">Stock</th>
          <th style="width: 140px">Vence</th>
          <th style="width: 150px">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for i in insumos %}
        <tr>
          <td>#{{ i.insumo_id }}</td>
          <td>{{ i.nombre }}</td>
          <td class="hide-sm"><span class="badge">{{ i.unidad }}</span></td>
          <td><strong>{{ i.stock }}</strong></td>
          <td class="hide-sm">
            {{ i.fecha_vencimiento.strftime('%d-%m-%Y') if i.fecha_vencimiento
            else '—' }}
          </td>
          <td class="actions">
            <a
              class="btn btn-outline btn-sm"
              href="{{ url_for('insumos.editar_insumo', insumo_id=i.insumo_id) }}"
            >
              Editar
            </a>
            <form
              method="post"
              action="{{ url_for('insumos.eliminar_insumo', insumo_id=i.insumo_id) }}"
              class="inline-form"
            >
              <button
                type="submit"
                class="btn btn-outline btn-sm btn-danger"
                onclick="return confirm('¿Eliminar este insumo?')"
              >
                Eliminar
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% endif %}
</section>
{% endblock %}
