<!-- templates/reset_password.html -->
{% extends 'base.html' %} {% block title %}Restablecer contraseña · Patitas QR{%
endblock %} {% block content %}
<section class="form-page">
  <header class="list-header">
    <h2 class="list-title">Restablecer contraseña</h2>
    <a class="btn btn-outline btn-sm" href="{{ url_for('sessions.login') }}"
      >← Volver a iniciar sesión</a
    >
  </header>

  <div class="card form-narrow">
    <p style="margin-top: 0">Cuenta: <strong>{{ correo }}</strong></p>

    <form
      id="reset-form"
      method="post"
      action="{{ url_for('passwords.reset_password_post', token=token) }}"
      class="form-grid"
    >
      <div class="field">
        <label for="nueva">Nueva contraseña</label>
        <div class="password-field">
          <input
            id="nueva"
            type="password"
            name="nueva"
            required
            minlength="8"
            autocomplete="new-password"
          />
          <button
            type="button"
            class="pw-toggle"
            aria-label="Mostrar u ocultar contraseña"
          >
            👁️
          </button>
        </div>
        <small class="muted">Mínimo 8 caracteres.</small>
      </div>

      <div class="field">
        <label for="repetir">Repetir nueva contraseña</label>
        <div class="password-field">
          <input
            id="repetir"
            type="password"
            name="repetir"
            required
            autocomplete="new-password"
          />
          <button
            type="button"
            class="pw-toggle"
            aria-label="Mostrar u ocultar contraseña"
          >
            👁️
          </button>
        </div>
      </div>

      <p
        id="pw-msg"
        class="muted"
        style="display: none; color: #ef4444; margin: 0"
      >
        Las contraseñas no coinciden o no cumplen el mínimo.
      </p>

      <div class="form-actions">
        <a class="btn btn-outline" href="{{ url_for('sessions.login') }}"
          >Cancelar</a
        >
        <button type="submit" class="btn btn-primary">Guardar</button>
      </div>
    </form>
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  (() => {
    // Mostrar/ocultar contraseña en ambos campos
    document.querySelectorAll(".password-field").forEach((wrap) => {
      const input = wrap.querySelector("input");
      const btn = wrap.querySelector(".pw-toggle");
      if (!input || !btn) return;

      let visible = false;
      const apply = (show) => {
        input.type = show ? "text" : "password";
        btn.textContent = show ? "🙈" : "👁️";
        btn.setAttribute("aria-pressed", show);
      };
      apply(visible);
      btn.addEventListener("click", () => {
        visible = !visible;
        apply(visible);
      });
    });

    // Validación mínima y coincidencia
    const form = document.getElementById("reset-form");
    const nueva = document.getElementById("nueva");
    const repetir = document.getElementById("repetir");
    const msg = document.getElementById("pw-msg");

    const check = () => {
      const a = (nueva.value || "").trim();
      const b = (repetir.value || "").trim();
      const okLen = a.length >= 8;
      const okMatch = a === b;
      msg.style.display = okLen && okMatch ? "none" : "block";
      repetir.setCustomValidity(
        okLen && okMatch ? "" : "Las contraseñas no coinciden o son muy cortas."
      );
      return okLen && okMatch;
    };

    nueva.addEventListener("input", check);
    repetir.addEventListener("input", check);
    form.addEventListener("submit", (e) => {
      if (!check()) e.preventDefault();
    });
  })();
</script>
{% endblock %}
